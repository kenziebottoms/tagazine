<!doctype html>
{% load static %}
<html>
    <head>
        <title>
            tag&middot;a&middot;zine | {% block title %} {% endblock %}
        </title>

        <!-- foundation -->
        <link rel="stylesheet" href="{% static 'zines/foundation/css/foundation.css' %}"/>
        <!-- custom stylesheet -->
        {% load sass_tags %}
        <link rel="stylesheet" href="{% sass_src 'zines/style.scss' %}"/>

        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

        <!-- jQuery UI -->
        <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

        <!-- angularJS -->
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.2/angular.min.js"></script>

        <!-- fonts -->
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700" rel="stylesheet">
        
        <!-- material icons -->
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

        <!-- lightbox -->
        <link href="{% static 'zines/lightbox2-master/src/css/lightbox.css' %}" rel="stylesheet">
        <script src="{% static 'zines/lightbox2-master/src/js/lightbox.js' %}"></script>

        <!-- Main Quill library -->
        <script src="//cdn.quilljs.com/1.1.7/quill.js"></script>
        <script src="//cdn.quilljs.com/1.1.7/quill.min.js"></script>
        <link href="https://cdn.quilljs.com/1.1.7/quill.snow.css" rel="stylesheet">
    </head>
    <body class="{% block classes %}{% endblock %}">
        <div id="editor">
            {% load app_filters %}

            {% if messages %}
                {% for message in messages %}
                    <span class="a">
                        <i class="{{ message.tags|lastWord }} material-icons md-48">{{ message.tags|lastWord }}</i>
                        <div class="label">{{ message }}</div>
                    </span>
                {% endfor %}
            {% endif %}
            
            {% block editor %}
            {% endblock %}
        </div>
        <div id="wrapper">
            <div id="header">
                <div id="logo">
                    <a href="/zines">
                        <i class="material-icons md-40">subtitles</i>taga<span>zine </span>
                    </a>
                </div>
                <ul class="menu inline">
                    <li>
                        <a href="{% url 'index' %}">home</a>
                    </li>
                    {% if user.is_authenticated %}
                        <li>
                            <a href="{% url 'profile' user.profile.id %}">profile</a>
                        </li>
                        {% if user.profile.hasUnPublishedContent %}
                            <li>
                                <a href="{% url 'drafts' %}">drafts</a>
                            </li>
                        {% endif %}
                        <li>
                            <a href="{% url 'logout_view' %}">Log Out</a>
                        </li>
                    {% else %}
                        <li>
                            <a href="{% url 'login_view' %}">Log in</a>
                        </li>
                    {% endif %}
                    <li>
                        <a>
                            <form id="search" method="GET" action="{% url 'search' %}">
                                <i class="material-icons md-36">search</i>
                                <input type="text" name="term" placeholder="Go for it." />
                            </form>
                        </a>
                    </li>
                </ul>
            </div>
            {% block body %} {% endblock %}
        </div>

        <script>
            function initQuill() {
                var quill = new Quill('#quill', {
                    theme: 'snow'
                });
                $('.ql-editor').focus(function() {
                    console.log('focus');
                    $('.ql-toolbar').addClass('active');
                    $('.ql-container').addClass('active');
                });
                $('.ql-editor').blur(function() {
                    console.log('focus');
                    $('.ql-toolbar').removeClass('active');
                    $('.ql-container').removeClass('active');
                });
            }
            function updateQuillHiddenInput(hiddenInputID) {
                $input = $('#'+hiddenInputID);
                $input.val($('#quill>div')[0].innerHTML);
            }
            function updateTags() {
                // tags field
                var tags = []
                $('#tag_list .tag').each(function() {
                    tags.push($(this).data('id'));
                });
                $('#id_tags').val(tags);
                console.log(tags);
            }
        </script>
        {% block scripts %} {% endblock %}
        <script>
            $(document).ready(function() {

                // update publish value before submitting
                $('#publish').click(function(e) {
                    e.preventDefault();
                    $('#id_published').val("True");
                    publish();
                });
                $('#unpublish').click(function(e) {
                    e.preventDefault();
                    $('#id_published').val("False");
                    publish();
                });

                // #editor
                $('div.label').removeClass('show');
                $('#editor').hover(function() {
                    $('div.label').addClass('show');
                }, function() {
                    $('div.label').removeClass('show');
                });

                // search
                $('#search').click(function(e) {
                    e.preventDefault();
                    $('#search input[type=text]').addClass('show');
                    $('#search input[type=text').focus();
                });
                $('#search input[type=text').blur(function(e) {
                    $('#search input[type=text]').removeClass('show');
                });
            });
        </script>
    </body>
</html>